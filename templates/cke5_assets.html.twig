{# 1. Importmap for ESM assets #}
{% if use_import_map and import_map is not empty %}
    <script type="importmap" {% if nonce %}nonce="{{ nonce }}"{% endif %}>
    {
        "imports": {{ import_map|json_encode|raw }}
    }
    </script>
{% endif %}

{# 2. Stylesheets #}
{% for css_url in bundle.css %}
    <link rel="stylesheet" href="{{ css_url }}" crossorigin="anonymous" {% if nonce %}nonce="{{ nonce }}"{% endif %}>
{% endfor %}

{# 3. UMD scripts #}
{% for asset in umd_assets %}
    <script src="{{ asset.url }}" {% if nonce %}nonce="{{ nonce }}"{% endif %}></script>
{% endfor %}

{# 4. Module preload for ESM assets #}
{% if use_import_map %}
    {% for asset in esm_assets %}
        <link rel="modulepreload" href="{{ asset.url }}" crossorigin="anonymous" {% if nonce %}nonce="{{ nonce }}"{% endif %}>
    {% endfor %}
{% endif %}
